function $parcel$export(t,e,s,r){Object.defineProperty(t,e,{get:s,set:r,enumerable:!0,configurable:!0})}var $parcel$global=globalThis,$parcel$modules={},$parcel$inits={},parcelRequire=$parcel$global.parcelRequire94c2;null==parcelRequire&&((parcelRequire=function(t){if(t in $parcel$modules)return $parcel$modules[t].exports;if(t in $parcel$inits){var e=$parcel$inits[t];delete $parcel$inits[t];var s={id:t,exports:{}};return $parcel$modules[t]=s,e.call(s.exports,s,s.exports),s.exports}var r=Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){$parcel$inits[t]=e},$parcel$global.parcelRequire94c2=parcelRequire);var parcelRegister=parcelRequire.register;parcelRegister("mDWTX",function(module,exports){function find(t,e=document){return e.querySelector(t)}function findAll(t,e=document){return[...e.querySelectorAll(t)]}$parcel$export(module.exports,"find",()=>find),$parcel$export(module.exports,"findAll",()=>findAll),$parcel$export(module.exports,"clamp",()=>clamp),$parcel$export(module.exports,"setClasses",()=>setClasses),$parcel$export(module.exports,"safeEval",()=>safeEval);let clamp=(t,e,s)=>t<e?e:t>s?s:t,toggleClasses=t=>{let e=t.classNames.filter(Boolean);e.length&&(t.toggle?t.element.classList.add(...e):t.element.classList.remove(...e))},addClasses=t=>toggleClasses({...t,toggle:!0}),removeClasses=t=>toggleClasses({...t,toggle:!1}),setClasses=t=>(t.element.className="",toggleClasses({...t,toggle:!0}));function safeEval(expression){let allowed=/^[0-9+\-*/().\s]+$/;if(!allowed.test(expression))throw Error("Invalid characters in expression");try{return eval(expression)}catch(error){throw Error("Invalid expression")}}function pointInRect(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height}});var $mDWTX=parcelRequire("mDWTX");class $ad2bcec7a0192558$var$Calculator{static{this.actions=["clear","backspace","%","()","="]}constructor(t=".calculator"){this.removeList=new Map,this.ctrl=new AbortController,this.element=(0,$mDWTX.find)(t),this.displayElement=(0,$mDWTX.find)(".display",this.element),this.keyboardElement=(0,$mDWTX.find)(".keyboard",this.element),this.cursorElement=(0,$mDWTX.find)(".cursor",this.displayElement),this.resetDisplay(),this.setupEvents()}setupEvents(){let{signal:t}=this.ctrl;for(let{target:e,eventName:s,callback:r}of[{target:this.displayElement,eventName:"mousedown",callback:t=>this.onMouseDown(t)},{target:this.keyboardElement,eventName:"click",callback:t=>this.onClickKeyboard(t)},{target:document,eventName:"keydown",callback:t=>this.onKeyDown(t)}])e.addEventListener(s,r,{signal:t})}onMouseDown(t){let{target:e,clientX:s}=t;if(!(e instanceof HTMLElement))return;let r=e.closest(".item.current .group");if(!r&&!(r=e.closest(".item.current")))return;let i=t=>{let e=t.getBoundingClientRect();return s<e.x+e.width/2?"left":"right"},n=e.closest(".letter"),l;if(n)l=i(n);else{l=i(r);let t=(0,$mDWTX.findAll)(".letter",r);n="left"===l?t[0]:t[t.length-1]}let a=(0,$mDWTX.findAll)(".item.current .letter",this.displayElement).indexOf(n);"right"===l&&a++,this.setCursorPosition(a)}onClickKeyboard(t){let e=t.target.closest(".key");if(!e)return;let{key:s}=e.dataset;s&&this.onPressKey(s)}onPressKey(t){let e=()=>1===t.length&&/[0-9+\-*/.()]/.test(t);$ad2bcec7a0192558$var$Calculator.actions.includes(t)?this.handleAction(t):e()&&this.handleKey(t)}handleKey(t){let e=t=>/\d/.test(t),s=t=>/[+\-*/]/.test(t),r=t=>/[*/]/.test(t),i=t=>/[()]/.test(t),n=t,l=this.getCharAt(this.cursorPosition-1);if(!s(l)||n!==l)if("."!==n||l){if(!e(l)&&!i(l)&&r(n)||l&&!e(l)&&"."===n)return;this.typeString(n),this.updateDisplayHtml()}else this.typeString("0."),this.updateDisplayHtml()}onKeyDown(t){if(!t.ctrlKey)if("Backspace"===t.key)this.handleAction("backspace");else if("Enter"===t.key)this.handleAction("=");else if("Escape"===t.key)this.handleAction("clear");else if("ArrowLeft"===t.key){this.cursorPosition--;let t=0;this.cursorPosition<t&&(this.cursorPosition=t),this.updateDisplayHtml()}else if("ArrowRight"===t.key){this.cursorPosition++;let t=this.currentString.length;this.cursorPosition>t&&(this.cursorPosition=t),this.updateDisplayHtml()}else this.onPressKey(t.key)}getCharAt(t){return this.currentString.charAt(t)}setCharAt(t,e){let s=this.currentString.slice(0,t),r=this.currentString.slice(t+1);this.currentString=s+e+r}handleAction(t){"clear"===t?this.resetDisplay():"backspace"===t?this.backspace():"%"===t?this.handlePercent():"()"===t?this.handleBrackets():"="===t&&this.handleEquals()}handlePercent(){if(!this.currentString)return;let t=this.findItemElement("current");if(!t)return;let e=(0,$mDWTX.find)(".cursor",t);if(!e)return;let s=e.previousElementSibling;if(!s||!s.classList.contains("group"))return;let r=(0,$mDWTX.findAll)(".group",t),i="",n=!1,l="0.";for(let t of r){let e=t.textContent||"";t===s?(i+=l+e,n=!0):i+=e}this.currentString=i,n&&(this.cursorPosition+=l.length),this.updateDisplayHtml()}handleBrackets(){let t=[...this.currentString],e=t.filter(t=>"("===t).length>t.filter(t=>")"===t).length?")":"(";this.typeString(e),this.updateDisplayHtml()}handleEquals(){if(this.currentString)this.currentResultString||this.calculateResult(),!(null===this.currentResult||isNaN(this.currentResult))&&(this.inputSameAsResult||(this.changeItemPosition("previous",null),this.changeItemPosition("current","previous"),this.changeItemPosition("next","current"),this.currentString=this.cleanE(this.currentResultString),this.cursorPosition=this.currentString.length))}cleanE(t){return t.replace(/e/g,"")}get inputSameAsResult(){let t=this.cleanE(this.currentString),e=this.cleanE(this.currentResultString);return t===e||parseFloat(t)===parseFloat(e)}backspace(){if(!this.currentString)return;let t=this.currentString.slice(0,this.cursorPosition-1),e=this.currentString.slice(this.cursorPosition);if(this.currentString=t+e,this.cursorPosition=Math.max(this.cursorPosition-1,0),!this.currentString){this.resetValues();let t=this.findItemElement("current");t&&t.remove(),this.createEmptyItemElement();return}this.updateDisplayHtml()}typeString(t){let e=this.currentString.slice(0,this.cursorPosition),s=this.currentString.slice(this.cursorPosition);this.currentString=e+t+s,this.cursorPosition+=t.length}destroy(){this.ctrl.abort()}clearItemElements(){let t=(0,$mDWTX.find)(".items",this.displayElement);t&&(t.innerHTML="")}resetDisplay(){this.resetValues(),this.clearItemElements(),this.createEmptyItemElement()}resetValues(){this.currentString="",this.cursorPosition=0,this.currentResult=null}createEmptyItemElement(){let t=this.createItemElement();this.appendItemElement(t),this.setItemElementData(t,{position:"current",groups:[{value:"0",spaced:!1,className:"faded"},{value:"|",spaced:!1,className:"cursor"}]})}setCursorPosition(t){this.cursorPosition=t,this.updateDisplayHtml()}findItemElement(t){return(0,$mDWTX.find)(`.item.${t}`,this.displayElement)}removeItemElement(t){t.classList.add("no-opacity");let e=setTimeout(()=>t.remove(),500);this.removeList.set(t,e)}cancelRemoveItem(t){t.classList.remove("no-opacity");let e=this.removeList.get(t);e&&(clearTimeout(e),this.removeList.delete(t))}updateDisplayHtml(){this.calculateResult(),this.updateCurrentItemElement(),this.updateNextItemElement()}updateCurrentItemElement(){let t=this.findItemElement("current");t||(t=this.createItemElement(),this.appendItemElement(t)),this.setItemElementData(t,{position:"current",groups:this.parseStringGroups()})}updateNextItemElement(){let t=this.findItemElement("next");if(this.inputSameAsResult||!this.currentResultString){t&&this.removeItemElement(t);return}t||(t=this.createItemElement(),this.appendItemElement(t)),this.setItemElementData(t,{position:"next",groups:[{value:this.currentResultString,spaced:!1,className:"digits"}]})}calculateResult(){try{this.currentResult=(0,$mDWTX.safeEval)(this.currentString)}catch{this.currentResult=null}return this.currentResult}get currentResultString(){return this.currentResult?.toString().replace(/[^0-9e.\-+]/g,"")||""}createItemElement(){let t=document.createElement("div");return t.className="item",t}createGroupElement(){let t=document.createElement("div");return t.className="group",t}setItemElementData(t,e){let{position:s,className:r,groups:i}=e;for(let e of((0,$mDWTX.setClasses)({element:t,classNames:["item",s,r]}),t.innerHTML="",i)){let s=this.createGroupElement();this.setGroupElementData(s,e),t.appendChild(s)}return t.parentElement&&this.updateItemElementScale(t),this.cancelRemoveItem(t),t}setGroupElementData(t,e){let{value:s,spaced:r,className:i}=e;if((0,$mDWTX.setClasses)({element:t,classNames:["group",i,r&&"spaced"]}),"|"===s)return t;for(let e of(t.innerHTML="",[...s])){let s=document.createElement("span");s.className="letter",s.textContent=e,t.appendChild(s)}}appendItemElement(t){(0,$mDWTX.find)(".items",this.displayElement).appendChild(t)}matchStringGroups(t=this.currentString){return(t.replace(/ +/g,"").match(/\d+(\.\d+)?|[+\-*/()|.]/g)||[]).map(t=>({value:t+""}))}parseStringGroups(t=this.currentString,e=this.cursorPosition){if("number"==typeof e&&e>=0){let s=[...t];s.splice(e,0,"|"),t=s.join("")}let s=this.matchStringGroups(t),r=[];for(let t=0;t<s.length;t++){let e=s[t].value,i=s[t-1]?.value,n=s[t+1]?.value;"|"===i&&(i=s[t-2]?.value),"|"===n&&(n=s[t+2]?.value);let l="|"===e||"."===e||/[0-9()]/.test(e)||/[+-]/.test(e)&&n&&/\d/.test(n)&&(!i||!/[\d()]/.test(i)),a="",o=e;/\d|\./.test(e)?a="digits":/[+\-*/]/.test(e)?a=/[\-+]/.test(e)?"digits":"colored":/[()]/.test(e)?a="faded":"|"===e&&(a="cursor"),r.push({value:o,spaced:!l,className:a})}return r}getItemElementPosition(t){let e=["previous","current","next"],s=t.classList;return e.find(t=>s.contains(t))||null}updateItemElementScale(t){let e=t.cloneNode(!0);e.classList.add("temp"),t.parentElement?.appendChild(e);let s=e.offsetWidth;e.remove();let r=getComputedStyle(t),i=parseFloat(r.paddingLeft)+parseFloat(r.paddingRight),n=this.displayElement.offsetWidth-i,l=(0,$mDWTX.clamp)(n/s,0,1);t.style.setProperty("--scale",l.toString())}changeItemPosition(t,e){let s=this.findItemElement(t);if(s){if("current"===t){let t=(0,$mDWTX.find)(".cursor",s);t&&t.remove()}e?(s.classList.remove(t),s.classList.add(e),this.updateItemElementScale(s)):this.removeItemElement(s)}}}const $ad2bcec7a0192558$var$calculator=new $ad2bcec7a0192558$var$Calculator;Object.assign(window,{calculator:$ad2bcec7a0192558$var$calculator});
//# sourceMappingURL=calculator.146e97f7.js.map
